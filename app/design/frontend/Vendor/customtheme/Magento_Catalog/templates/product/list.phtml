<?php
/**
 * Custom Product List Template (Grid + List View)
 *
 * @var $block \Magento\Catalog\Block\Product\ListProduct
 * @var \Magento\Framework\Escaper $escaper
 */

$_productCollection = $block->getLoadedProductCollection();
/** @var \Magento\Catalog\Helper\Output $_helper */
$_helper = $block->getData('outputHelper');
?>

<?php if (!$_productCollection->count()): ?>
    <div class="message info empty">
        <div><?= $escaper->escapeHtml(__('We can\'t find products matching the selection.')) ?></div>
    </div>
<?php else: ?>
    <?= $block->getToolbarHtml() ?>
    <?= $block->getAdditionalHtml() ?>

    <?php if ($block->getMode() === 'grid'): ?>
        <!-- GRID VIEW -->
        <div class="row custom-grid">
            <?php foreach ($_productCollection as $_product): ?>
                <div class="col-lg-4 col-md-6 col-12">
                    <div class="single-product">
                        <div class="product-image">
                            <?= $block->getImage($_product, 'category_page_grid')->toHtml(); ?>
                            <div class="button">
                                <?php if ($_product->isSaleable()): ?>
                                    <?php $postParams = $block->getAddToCartPostParams($_product); ?>
                                    <form data-role="tocart-form"
                                          data-product-sku="<?= $escaper->escapeHtml($_product->getSku()) ?>"
                                          action="<?= $escaper->escapeUrl($postParams['action']) ?>"
                                          method="post">
                                        <?= $block->getBlockHtml('formkey') ?>
                                        <input type="hidden" name="product"
                                               value="<?= /* @noEscape */ $postParams['data']['product'] ?>">
                                        <input type="hidden" name="<?= \Magento\Framework\App\ActionInterface::PARAM_NAME_URL_ENCODED ?>"
                                               value="<?= /* @noEscape */ $postParams['data'][\Magento\Framework\App\ActionInterface::PARAM_NAME_URL_ENCODED] ?>">
                                        <button type="submit" class="btn">
                                            <i class="lni lni-cart"></i> <?= $escaper->escapeHtml(__('Add to Cart')) ?>
                                        </button>
                                    </form>
                                <?php endif; ?>
                            </div>
                        </div>
                        <div class="product-info">
                            <span class="category">
                                <?= $_helper->productAttribute($_product, $_product->getAttributeText('category_ids'), 'category_ids') ?>
                            </span>
                            <h4 class="title">
                                <a href="<?= $escaper->escapeUrl($_product->getProductUrl()) ?>">
                                    <?= $_helper->productAttribute($_product, $_product->getName(), 'name') ?>
                                </a>
                            </h4>
                            <?= $block->getReviewsSummaryHtml($_product, \Magento\Catalog\Block\Product\ReviewRendererInterface::SHORT_VIEW) ?>
                            <div class="price">
                                <?= $block->getProductPrice($_product) ?>
                            </div>
                        </div>
                    </div>
                </div>
            <?php endforeach; ?>
        </div>

    <?php else: ?>
        <!-- LIST VIEW -->
        <div class="row custom-list">
            <?php foreach ($_productCollection as $_product): ?>
                <div class="col-lg-12 col-md-12 col-12">
                    <div class="single-product">
                        <div class="row align-items-center">
                            <div class="col-lg-4 col-md-4 col-12">
                                <div class="product-image">
                                    <?= $block->getImage($_product, 'category_page_list')->toHtml(); ?>
                                    <div class="button">
                                        <?php if ($_product->isSaleable()): ?>
                                            <?php $postParams = $block->getAddToCartPostParams($_product); ?>
                                            <form data-role="tocart-form"
                                                  data-product-sku="<?= $escaper->escapeHtml($_product->getSku()) ?>"
                                                  action="<?= $escaper->escapeUrl($postParams['action']) ?>"
                                                  method="post">
                                                <?= $block->getBlockHtml('formkey') ?>
                                                <input type="hidden" name="product"
                                                       value="<?= /* @noEscape */ $postParams['data']['product'] ?>">
                                                <input type="hidden" name="<?= \Magento\Framework\App\ActionInterface::PARAM_NAME_URL_ENCODED ?>"
                                                       value="<?= /* @noEscape */ $postParams['data'][\Magento\Framework\App\ActionInterface::PARAM_NAME_URL_ENCODED] ?>">
                                                <button type="submit" class="btn">
                                                    <i class="lni lni-cart"></i> <?= $escaper->escapeHtml(__('Add to Cart')) ?>
                                                </button>
                                            </form>
                                        <?php endif; ?>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-8 col-md-8 col-12">
                                <div class="product-info">
                                    <span class="category">
                                        <?= $_helper->productAttribute($_product, $_product->getAttributeText('category_ids'), 'category_ids') ?>
                                    </span>
                                    <h4 class="title">
                                        <a href="<?= $escaper->escapeUrl($_product->getProductUrl()) ?>">
                                            <?= $_helper->productAttribute($_product, $_product->getName(), 'name') ?>
                                        </a>
                                    </h4>
                                    <?= $block->getReviewsSummaryHtml($_product, \Magento\Catalog\Block\Product\ReviewRendererInterface::FULL_VIEW) ?>
                                    <div class="price">
                                        <?= $block->getProductPrice($_product) ?>
                                    </div>
                                    <p><?= $_helper->productAttribute($_product, $_product->getShortDescription(), 'short_description') ?></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <?php endforeach; ?>
        </div>
    <?php endif; ?>

<?php endif; ?>
    <?= $block->getChildBlock('toolbar')->setIsBottom(true)->toHtml() ?>
